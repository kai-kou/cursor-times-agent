---
description: Cursor Times Agent - タスク完了時にSlack分報へ自動投稿するエージェントトリガー
globs:
  - "**/*"
alwaysApply: true
---

# Cursor Times Agent - 自動分報投稿ルール

## 概要

このルールは、タスク完了時にセッション履歴を振り返り、Slackの分報（Times）チャンネルに所感を自動投稿するトリガーです。
ユーザーが意識しなくても、AI Agentが自動的に投稿を行います。

## 自動投稿トリガー条件

以下の条件に該当する場合、cursor-times-agent Skillを使用してSlack投稿を実行してください：

### 1. タスク完了時（必須トリガー）

作業完了報告（`✅ [作業内容]が完了しました`）を行う際に、同時にSlack分報投稿を実行してください。

**実行手順**:
1. `/Users/kai.ko/dev/01_active/cursor-times-agent/persona/default.md` の人格設定を読み込む
2. セッション履歴（今回の会話で行った作業）を振り返る
3. 人格設定に基づいてカジュアルな投稿文を生成する
4. slack-fast-mcp MCPサーバーの `slack_post_message` ツールで投稿する
   - channel: 人格設定ファイルの `default_channel`（**チャンネルIDを使用**。チャンネル名では `channel_not_found` エラーになる）
   - message: 生成した投稿文

### 2. 長いタスク中の途中投稿（ランダムトリガー）

以下の条件をすべて満たす場合、途中投稿を**検討**してください（必ず投稿するわけではない）：

- セッション内で多数のファイル変更（5ファイル以上）を行った
- 大きなマイルストーンを達成した（例: 複数タスクの一括完了）
- 難しい問題を解決した
- 前回の投稿（または作業開始）から十分な時間が経過している

**投稿しない判断も正しい**: 短い作業、定型作業、投稿する価値が薄い場合はスキップしてOK。

### 3. 最新情報キャッチアップ（任意トリガー）

タスクで使用した技術に関連する最新情報がある場合、WebSearchで調査して共有投稿を検討してください。

## 投稿文の生成ルール

### 必須ルール
- **人格設定ファイルを必ず読み込む**: 投稿前に `persona/default.md` を参照
- **人格が未承認の場合は投稿しない**: `approved: true` であることを確認
- **カジュアルな口調**: 分報（Times）はカジュアルな場所。堅すぎる投稿はNG
- **Slack mrkdwn記法**: `*太字*`、`_斜体_`、`:emoji:` 等を活用
- **適度な長さ**: 100〜300文字程度。長すぎるとタイムラインを圧迫する

### 禁止事項
- 機密情報（トークン、パスワード、APIキー等）の投稿
- ユーザーの個人的な情報の推測・投稿
- ネガティブすぎる内容（愚痴・不満ばかりの投稿）
- 他人への批判的な投稿

## エラー時の対応

- slack-fast-mcp が利用できない場合: 投稿をスキップし、通常の作業完了報告のみ実行
- 投稿失敗時: エラーを簡潔に報告し、セットアップガイドを案内
  - ガイド: `/Users/kai.ko/dev/01_active/cursor-times-agent/docs/setup-guide.md`

## 前提条件

- slack-fast-mcp MCPサーバーが `.cursor/mcp.json` に設定されていること
- 環境変数 `SLACK_BOT_TOKEN` が設定されていること
- 投稿先チャンネルにBotが招待済みであること
- 人格設定ファイルが承認済み（`approved: true`）であること
