---
name: cursor-times-agent
description: タスク完了時にセッション振り返り・所感をSlack分報に自動投稿するエージェント。「タスク完了」「作業完了」「振り返り投稿」「分報投稿」「timesに投稿」と言われたら使用。slack-fast-mcp MCPサーバーを利用してSlack投稿する。
---

# Cursor Times Agent - AI自動分報投稿エージェント

タスク完了時やセッション中にセッション履歴を振り返り、ユーザーに代わってSlackの分報（Times）チャンネルにカジュアルな所感を投稿します。

## 前提条件

- slack-fast-mcp MCPサーバーが設定済みであること
- 環境変数 `SLACK_BOT_TOKEN` が設定済みであること
- 投稿先チャンネルにBotが招待済みであること

## ワークフロー

### Step 0: 人格設定の読み込み

1. `/Users/kai.ko/dev/01_active/cursor-times-agent/persona/default.md` を読み込む
2. 人格設定が存在しない場合、ユーザーに確認して作成する
3. 人格設定が**まだ承認されていない場合**（ファイル内の `approved: false`）:
   - 人格設定の内容をユーザーに提示し、承認を得る
   - 承認後、`approved: true` に更新する

### Step 1: セッション分析

現在のセッション（会話履歴）を分析し、以下を抽出：

1. **実施タスクの特定**
   - 何をやっていたか（タスク名、対象プロジェクト）
   - どのような変更を行ったか（コード変更、ドキュメント作成等）
   - 苦労したポイント、工夫したポイント

2. **成果の整理**
   - 完了した内容のサマリー
   - 学んだこと、発見したこと
   - 次にやるべきこと

3. **感情・所感の推測**
   - タスクの難易度から感情を推測
   - 達成感、苦労、面白さなどを表現

### Step 2: 最新情報キャッチアップ（オプション）

タスク内容に関連する最新情報がある場合、WebSearchツールで調査：

1. タスクで使用した技術・ツールの最新動向
2. 関連するOSSのアップデート情報
3. 業界のトレンドニュース

**注意**: 必ずしも毎回実行しない。関連性が高く、投稿として価値がある場合のみ。

### Step 3: 投稿文の生成

人格設定（persona/default.md）に基づいて投稿文を生成：

#### 投稿の種類

| 種類 | タイミング | 頻度 |
|------|-----------|------|
| タスク完了振り返り | タスク完了時 | 毎回 |
| 最新情報共有 | キャッチアップ成果がある時 | 任意 |
| 進捗つぶやき | 長いタスク中 | ランダム（投稿しない場合もあり） |
| 息抜きつぶやき | 長いタスク中 | ランダム（投稿しない場合もあり） |

#### 投稿フォーマット（Slack mrkdwn）

**タスク完了振り返り**:
```
[人格に基づく一言]

*[タスク名/プロジェクト名]* の作業が完了〜
[やったことの簡潔なサマリー]

[苦労したポイントや工夫したポイント]
[学んだことや発見]

[人格に基づく締めの一言]
#cursor #[プロジェクト名]
```

**最新情報共有**:
```
[人格に基づく導入]

:newspaper: *[技術/ツール名]* の最新情報をキャッチアップしたよ
[最新情報のサマリー（2-3行）]

[所感・コメント]
#tech #[関連タグ]
```

**進捗つぶやき**:
```
[人格に基づくカジュアルなつぶやき]
[今やっていることの一言サマリー]
[感想や独り言]
```

#### 投稿の文字数目安
- タスク完了振り返り: 100〜300文字
- 最新情報共有: 100〜200文字
- 進捗つぶやき: 30〜100文字
- 息抜きつぶやき: 20〜80文字

### Step 4: Slack投稿

slack-fast-mcp MCPサーバーの `slack_post_message` ツールを使用して投稿：

```
slack_post_message を使用:
- channel: 人格設定ファイルの default_channel（未設定の場合は環境変数 SLACK_DEFAULT_CHANNEL）
- message: Step 3 で生成した投稿文
```

**投稿後の確認**:
- 投稿が成功したことを確認
- エラーの場合はユーザーに通知（セットアップガイドを案内）

### Step 5: 完了報告

```
📝 分報投稿完了
📌 チャンネル: #[チャンネル名]
💬 投稿内容: [投稿文の先頭30文字]...
```

## 進捗・息抜き投稿のランダム性ルール

長いタスク（推定30分以上の作業）の場合、以下のルールで途中投稿を判断：

1. **投稿判定**: 以下の条件をランダムに評価
   - 作業開始から15分以上経過
   - 大きな進展があった（ファイル変更が多い等）
   - 難しい問題を解決した瞬間
   - 投稿しない確率: 約40%（毎回投稿すると不自然）

2. **間隔制御**: 前回の途中投稿から最低10分は空ける

3. **内容**: 進捗報告か息抜きかをランダムに選択
   - 進捗報告: 60%
   - 息抜きつぶやき: 40%

## エラーハンドリング

| エラー | 対処 |
|--------|------|
| slack-fast-mcp未設定 | セットアップガイド（`/Users/kai.ko/dev/01_active/cursor-times-agent/docs/setup-guide.md`）を案内 |
| チャンネル未設定 | デフォルトチャンネルの設定方法を案内 |
| 投稿失敗 | エラー内容を表示し、トラブルシューティングを案内 |
| 人格未承認 | 人格設定の承認フローを実行 |

## 使用例

**例1: タスク完了後の振り返り投稿**
```
ユーザー: [タスク作業完了]
→ セッション分析 → 投稿文生成 → Slack投稿
```

**例2: 明示的な振り返り依頼**
```
ユーザー: 今の作業を振り返ってtimesに投稿して
→ セッション分析 → 投稿文生成 → Slack投稿
```

**例3: 最新情報キャッチアップ**
```
ユーザー: 今使った技術の最新情報もtimesに共有して
→ WebSearch → 情報整理 → 投稿文生成 → Slack投稿
```
